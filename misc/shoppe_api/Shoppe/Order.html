<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>class Shoppe::Order - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "../";
</script>

<script src="../js/jquery.js"></script>
<script src="../js/darkfish.js"></script>

<link href="../css/fonts.css" rel="stylesheet">
<link href="../css/rdoc.css" rel="stylesheet">



<body id="top" role="document" class="class">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="../index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="../table_of_contents.html#pages">Pages</a>
    <a href="../table_of_contents.html#classes">Classes</a>
    <a href="../table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  

  <div id="class-metadata">
    
    <div id="parent-class-section" class="nav-section">
  <h3>Parent</h3>

  
  <p class="link">ActiveRecord::Base
  
</div>

    
    <div id="extends-section" class="nav-section">
  <h3>Extended With Modules</h3>

  <ul class="link-list">
    
  
    <li><span class="extend">ActiveModel::Callbacks</span>
  
  
  </ul>
</div>

    <!-- Method Quickref -->
<div id="method-list-section" class="nav-section">
  <h3>Methods</h3>

  <ul class="link-list" role="directory">
    
    <li ><a href="#method-c-ransackable_associations">::ransackable_associations</a>
    
    <li ><a href="#method-c-ransackable_attributes">::ransackable_attributes</a>
    
    <li ><a href="#method-i-accept-21">#accept!</a>
    
    <li ><a href="#method-i-accepted-3F">#accepted?</a>
    
    <li ><a href="#method-i-available_delivery_services">#available_delivery_services</a>
    
    <li ><a href="#method-i-balance">#balance</a>
    
    <li ><a href="#method-i-billing_name">#billing_name</a>
    
    <li ><a href="#method-i-build_time">#build_time</a>
    
    <li ><a href="#method-i-building-3F">#building?</a>
    
    <li ><a href="#method-i-cache_delivery_pricing">#cache_delivery_pricing</a>
    
    <li ><a href="#method-i-cache_delivery_pricing-21">#cache_delivery_pricing!</a>
    
    <li ><a href="#method-i-confirm-21">#confirm!</a>
    
    <li ><a href="#method-i-confirming-3F">#confirming?</a>
    
    <li ><a href="#method-i-courier_tracking_url">#courier_tracking_url</a>
    
    <li ><a href="#method-i-customer_name">#customer_name</a>
    
    <li ><a href="#method-i-deliver_accepted_order_email">#deliver_accepted_order_email</a>
    
    <li ><a href="#method-i-deliver_received_order_email">#deliver_received_order_email</a>
    
    <li ><a href="#method-i-deliver_rejected_order_email">#deliver_rejected_order_email</a>
    
    <li ><a href="#method-i-delivery_cost_price">#delivery_cost_price</a>
    
    <li ><a href="#method-i-delivery_price">#delivery_price</a>
    
    <li ><a href="#method-i-delivery_required-3F">#delivery_required?</a>
    
    <li class="calls-super" ><a href="#method-i-delivery_service">#delivery_service</a>
    
    <li ><a href="#method-i-delivery_service_price">#delivery_service_price</a>
    
    <li ><a href="#method-i-delivery_service_prices">#delivery_service_prices</a>
    
    <li ><a href="#method-i-delivery_tax_amount">#delivery_tax_amount</a>
    
    <li ><a href="#method-i-delivery_tax_rate">#delivery_tax_rate</a>
    
    <li ><a href="#method-i-empty-3F">#empty?</a>
    
    <li ><a href="#method-i-full_name">#full_name</a>
    
    <li ><a href="#method-i-has_items-3F">#has_items?</a>
    
    <li ><a href="#method-i-invoiced-3F">#invoiced?</a>
    
    <li ><a href="#method-i-items_sub_total">#items_sub_total</a>
    
    <li ><a href="#method-i-number">#number</a>
    
    <li ><a href="#method-i-paid_in_full-3F">#paid_in_full?</a>
    
    <li ><a href="#method-i-payment_outstanding-3F">#payment_outstanding?</a>
    
    <li ><a href="#method-i-proceed_to_confirm">#proceed_to_confirm</a>
    
    <li ><a href="#method-i-profit">#profit</a>
    
    <li ><a href="#method-i-received-3F">#received?</a>
    
    <li ><a href="#method-i-reject-21">#reject!</a>
    
    <li ><a href="#method-i-rejected-3F">#rejected?</a>
    
    <li ><a href="#method-i-remove_delivery_service_if_invalid">#remove_delivery_service_if_invalid</a>
    
    <li ><a href="#method-i-ship-21">#ship!</a>
    
    <li ><a href="#method-i-shipped-3F">#shipped?</a>
    
    <li ><a href="#method-i-tax">#tax</a>
    
    <li ><a href="#method-i-total">#total</a>
    
    <li ><a href="#method-i-total_before_tax">#total_before_tax</a>
    
    <li ><a href="#method-i-total_cost">#total_cost</a>
    
    <li ><a href="#method-i-total_items">#total_items</a>
    
    <li ><a href="#method-i-total_weight">#total_weight</a>
    
    <li ><a href="#method-i-valid_delivery_service-3F">#valid_delivery_service?</a>
    
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-labelledby="class-Shoppe::Order">
  <h1 id="class-Shoppe::Order" class="class">
    class Shoppe::Order
  </h1>

  <section class="description">
    
  </section>

  
  
  
  <section id="5Buntitled-5D" class="documentation-section">
    

    

    
    <section class="constants-list">
      <header>
        <h3>Constants</h3>
      </header>
      <dl>
      
        <dt id="EMAIL_REGEX">EMAIL_REGEX
        
        <dd>
        
      
        <dt id="PHONE_REGEX">PHONE_REGEX
        
        <dd>
        
      
        <dt id="STATUSES">STATUSES
        
        <dd><p>An array of all the available statuses for an order</p>
        
      
      </dl>
    </section>
    

    
    <section class="attribute-method-details" class="method-section">
      <header>
        <h3>Attributes</h3>
      </header>

      
      <div id="attribute-i-billing_address_id" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">billing_address_id</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Some methods for setting the billing &amp; delivery addresses</p>
        
        </div>
      </div>
      
      <div id="attribute-i-delivery_address_id" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">delivery_address_id</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Some methods for setting the billing &amp; delivery addresses</p>
        
        </div>
      </div>
      
      <div id="attribute-i-save_addresses" class="method-detail">
        <div class="method-heading attribute-method-heading">
          <span class="method-name">save_addresses</span><span
            class="attribute-access-type">[RW]</span>
        </div>

        <div class="method-description">
        
        <p>Some methods for setting the billing &amp; delivery addresses</p>
        
        </div>
      </div>
      
    </section>
    

    
     <section id="public-class-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Class Methods</h3>
       </header>

    
      <div id="method-c-ransackable_associations" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ransackable_associations</span><span
            class="method-args">(_auth_object = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="ransackable_associations-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 97</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ransackable_associations</span>(<span class="ruby-identifier">_auth_object</span> = <span class="ruby-keyword">nil</span>)
  []
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-c-ransackable_attributes" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ransackable_attributes</span><span
            class="method-args">(_auth_object = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="ransackable_attributes-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 93</span>
<span class="ruby-keyword">def</span> <span class="ruby-keyword">self</span>.<span class="ruby-identifier">ransackable_attributes</span>(<span class="ruby-identifier">_auth_object</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-node">%w(id billing_postcode billing_address1 billing_address2 billing_address3 billing_address4 first_name last_name company email_address phone_number consignment_number status received_at)</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">_ransackers</span>.<span class="ruby-identifier">keys</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
     <section id="public-instance-5Buntitled-5D-method-details" class="method-section">
       <header>
         <h3>Public Instance Methods</h3>
       </header>

    
      <div id="method-i-accept-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">accept!</span><span
            class="method-args">(user = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Mark order as accepted</p>

<p>@param user [Shoppe::User] the user who carried out this action</p>
          
          

          
          <div class="method-source-code" id="accept-21-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/actions.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">accept!</span>(<span class="ruby-identifier">user</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">run_callbacks</span> <span class="ruby-value">:acceptance</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accepted_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">accepter</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;accepted&#39;</span>
    <span class="ruby-identifier">save!</span>
    <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:accept!</span>)
    <span class="ruby-identifier">deliver_accepted_order_email</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-accepted-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">accepted?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Has this order been accepted?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="accepted-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/states.rb, line 55</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">accepted?</span>
  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">accepted_at</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-available_delivery_services" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">available_delivery_services</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>An array of all the delivery services which are suitable for this order in
it&#39;s current state (based on its current weight)</p>

<p>@return [Array] an array of <a
href="DeliveryService.html">Shoppe::DeliveryService</a> objects</p>
          
          

          
          <div class="method-source-code" id="available_delivery_services-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 130</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">available_delivery_services</span>
  <span class="ruby-identifier">delivery_service_prices</span>.<span class="ruby-identifier">map</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:delivery_service</span>).<span class="ruby-identifier">uniq</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-balance" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">balance</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The total amount due on the order</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="balance-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 78</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">balance</span>
  <span class="ruby-ivar">@balance</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">total</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">amount_paid</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-billing_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">billing_name</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The name for billing purposes</p>

<p>@return [String]</p>
          
          

          
          <div class="method-source-code" id="billing_name-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 25</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">billing_name</span>
  <span class="ruby-identifier">company</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">full_name</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{full_name} (#{company})&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-build_time" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">build_time</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The length of time the customer spent building the order before submitting
it to us. The time from first item in basket to received.</p>

<p>@return [Float] - the length of time</p>
          
          

          
          <div class="method-source-code" id="build_time-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 52</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">build_time</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">received_at</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-identifier">created_at</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">received_at</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-building-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">building?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is this order still being built by the user?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="building-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/states.rb, line 34</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">building?</span>
  <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;building&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cache_delivery_pricing" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache_delivery_pricing</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Cache delivery prices for the order</p>
          
          

          
          <div class="method-source-code" id="cache_delivery_pricing-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 84</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cache_delivery_pricing</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">delivery_service</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_service_id</span>, <span class="ruby-identifier">delivery_service</span>.<span class="ruby-identifier">id</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_price</span>, <span class="ruby-identifier">delivery_price</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_cost_price</span>, <span class="ruby-identifier">delivery_cost_price</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_tax_rate</span>, <span class="ruby-identifier">delivery_tax_rate</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_service_id</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_price</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_cost_price</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_tax_rate</span>, <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">write_attribute</span> <span class="ruby-value">:delivery_tax_amount</span>, <span class="ruby-keyword">nil</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-cache_delivery_pricing-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">cache_delivery_pricing!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Cache prices and save the order</p>
          
          

          
          <div class="method-source-code" id="cache_delivery_pricing-21-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 100</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">cache_delivery_pricing!</span>
  <span class="ruby-identifier">cache_delivery_pricing</span>
  <span class="ruby-identifier">save!</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-confirm-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">confirm!</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method should be executed by the application when the order should be
completed by the customer. It will raise exceptions if anything goes wrong
or return true if the order has been confirmed successfully</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="confirm-21-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/actions.rb, line 29</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">confirm!</span>
  <span class="ruby-identifier">no_stock_of</span> = <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">select</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:validate_stock_levels</span>)
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">no_stock_of</span>.<span class="ruby-identifier">empty?</span>
    <span class="ruby-identifier">fail</span> <span class="ruby-constant">Shoppe</span><span class="ruby-operator">::</span><span class="ruby-constant">Errors</span><span class="ruby-operator">::</span><span class="ruby-constant">InsufficientStockToFulfil</span>, <span class="ruby-identifier">order</span><span class="ruby-operator">:</span> <span class="ruby-keyword">self</span>, <span class="ruby-identifier">out_of_stock_items</span><span class="ruby-operator">:</span> <span class="ruby-identifier">no_stock_of</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-identifier">run_callbacks</span> <span class="ruby-value">:confirmation</span> <span class="ruby-keyword">do</span>
    <span class="ruby-comment"># If we have successfully charged the card (i.e. no exception) we can go ahead and mark this</span>
    <span class="ruby-comment"># order as &#39;received&#39; which means it can be accepted by staff.</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;received&#39;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">received_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-identifier">save!</span>

    <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:confirm!</span>)

    <span class="ruby-comment"># Send an email to the customer</span>
    <span class="ruby-identifier">deliver_received_order_email</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-comment"># We&#39;re all good.</span>
  <span class="ruby-keyword">true</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-confirming-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">confirming?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is this order in the user confirmation step?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="confirming-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/states.rb, line 41</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">confirming?</span>
  <span class="ruby-identifier">status</span> <span class="ruby-operator">==</span> <span class="ruby-string">&#39;confirming&#39;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-courier_tracking_url" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">courier_tracking_url</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The URL which can be used to track the delivery of this order</p>

<p>@return [String]</p>
          
          

          
          <div class="method-source-code" id="courier_tracking_url-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 210</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">courier_tracking_url</span>
  <span class="ruby-keyword">return</span> <span class="ruby-keyword">nil</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">shipped_at</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">consignment_number</span>.<span class="ruby-identifier">blank?</span>
  <span class="ruby-ivar">@courier_tracking_url</span> <span class="ruby-operator">||=</span> <span class="ruby-identifier">delivery_service</span>.<span class="ruby-identifier">tracking_url_for</span>(<span class="ruby-keyword">self</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-customer_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">customer_name</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The name of the customer in the format of “Company (First Last)” or if they
don&#39;t have company specified, just “First Last”.</p>

<p>@return [String]</p>
          
          

          
          <div class="method-source-code" id="customer_name-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">customer_name</span>
  <span class="ruby-identifier">company</span>.<span class="ruby-identifier">blank?</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">full_name</span> <span class="ruby-operator">:</span> <span class="ruby-node">&quot;#{company} (#{full_name})&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-deliver_accepted_order_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">deliver_accepted_order_email</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="deliver_accepted_order_email-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/actions.rb, line 80</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">deliver_accepted_order_email</span>
  <span class="ruby-constant">Shoppe</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderMailer</span>.<span class="ruby-identifier">accepted</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">deliver</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-deliver_received_order_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">deliver_received_order_email</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="deliver_received_order_email-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/actions.rb, line 88</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">deliver_received_order_email</span>
  <span class="ruby-constant">Shoppe</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderMailer</span>.<span class="ruby-identifier">received</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">deliver</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-deliver_rejected_order_email" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">deliver_rejected_order_email</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          
          
          

          
          <div class="method-source-code" id="deliver_rejected_order_email-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/actions.rb, line 84</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">deliver_rejected_order_email</span>
  <span class="ruby-constant">Shoppe</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderMailer</span>.<span class="ruby-identifier">rejected</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">deliver</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_cost_price" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_cost_price</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The cost of delivering this order in its current state</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="delivery_cost_price-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 171</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_cost_price</span>
  <span class="ruby-identifier">read_attribute</span>(<span class="ruby-value">:delivery_cost_price</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">delivery_service_price</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:cost_price</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_price" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_price</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The price for delivering this order in its current state</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="delivery_price-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 164</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_price</span>
  <span class="ruby-identifier">read_attribute</span>(<span class="ruby-value">:delivery_price</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">delivery_service_price</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:price</span>) <span class="ruby-operator">||</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_required-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_required?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is delivery required for this order?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="delivery_required-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 122</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_required?</span>
  <span class="ruby-identifier">total_weight</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_service" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_service</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The recommended delivery service for this order</p>

<p>@return [Shoppe::DeliveryService]</p>
          
          
            <div class="method-calls-super">
              Calls superclass method
              
            </div>
          

          
          <div class="method-source-code" id="delivery_service-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 150</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_service</span>
  <span class="ruby-keyword">super</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">available_delivery_services</span>.<span class="ruby-identifier">first</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_service_price" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_service_price</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the delivery price for this order in its current state</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="delivery_service_price-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 157</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_service_price</span>
  <span class="ruby-identifier">delivery_service</span> <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">delivery_service_prices</span>.<span class="ruby-identifier">find</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">price</span><span class="ruby-operator">|</span> <span class="ruby-identifier">price</span>.<span class="ruby-identifier">delivery_service</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">delivery_service</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_service_prices" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_service_prices</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>An array of all the delivery service prices which can be applied to this
order.</p>

<p>@return [Array] an array of Shoppe:DeliveryServicePrice objects</p>
          
          

          
          <div class="method-source-code" id="delivery_service_prices-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 137</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_service_prices</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">delivery_required?</span>
    <span class="ruby-identifier">prices</span> = <span class="ruby-constant">Shoppe</span><span class="ruby-operator">::</span><span class="ruby-constant">DeliveryServicePrice</span>.<span class="ruby-identifier">joins</span>(<span class="ruby-value">:delivery_service</span>).<span class="ruby-identifier">where</span>(<span class="ruby-identifier">shoppe_delivery_services</span><span class="ruby-operator">:</span> { <span class="ruby-identifier">active</span><span class="ruby-operator">:</span> <span class="ruby-keyword">true</span> }).<span class="ruby-identifier">order</span>(<span class="ruby-value">:price</span>).<span class="ruby-identifier">for_weight</span>(<span class="ruby-identifier">total_weight</span>)
    <span class="ruby-identifier">prices</span> = <span class="ruby-identifier">prices</span>.<span class="ruby-identifier">select</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">p</span><span class="ruby-operator">|</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">countries</span>.<span class="ruby-identifier">empty?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">p</span>.<span class="ruby-identifier">country?</span>(<span class="ruby-identifier">delivery_country</span>) }
    <span class="ruby-identifier">prices</span>.<span class="ruby-identifier">sort</span> { <span class="ruby-operator">|</span><span class="ruby-identifier">x</span>, <span class="ruby-identifier">y</span><span class="ruby-operator">|</span> (<span class="ruby-identifier">y</span>.<span class="ruby-identifier">delivery_service</span>.<span class="ruby-identifier">default?</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>) <span class="ruby-operator">&lt;=&gt;</span> (<span class="ruby-identifier">x</span>.<span class="ruby-identifier">delivery_service</span>.<span class="ruby-identifier">default?</span> <span class="ruby-operator">?</span> <span class="ruby-value">1</span> <span class="ruby-operator">:</span> <span class="ruby-value">0</span>) } <span class="ruby-comment"># Order by truthiness</span>
  <span class="ruby-keyword">else</span>
    []
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_tax_amount" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_tax_amount</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The tax amount due for the delivery of this order in its current state</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="delivery_tax_amount-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 178</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_tax_amount</span>
  <span class="ruby-identifier">read_attribute</span>(<span class="ruby-value">:delivery_tax_amount</span>) <span class="ruby-operator">||</span>
    <span class="ruby-identifier">delivery_price</span> <span class="ruby-operator">/</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">100</span>) <span class="ruby-operator">*</span> <span class="ruby-identifier">delivery_tax_rate</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-delivery_tax_rate" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">delivery_tax_rate</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The tax rate for the delivery of this order in its current state</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="delivery_tax_rate-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 186</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">delivery_tax_rate</span>
  <span class="ruby-identifier">read_attribute</span>(<span class="ruby-value">:delivery_tax_rate</span>) <span class="ruby-operator">||</span>
    <span class="ruby-identifier">delivery_service_price</span>.<span class="ruby-identifier">try</span>(<span class="ruby-value">:tax_rate</span>).<span class="ruby-identifier">try</span>(<span class="ruby-value">:rate_for</span>, <span class="ruby-keyword">self</span>) <span class="ruby-operator">||</span>
    <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-empty-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">empty?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is this order empty? (i.e. doesn&#39;t have any items associated with it)</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="empty-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 75</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">empty?</span>
  <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">empty?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-full_name" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">full_name</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The full name of the customer created by concatinting the first &amp; last
name</p>

<p>@return [String]</p>
          
          

          
          <div class="method-source-code" id="full_name-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 68</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">full_name</span>
  <span class="ruby-node">&quot;#{first_name} #{last_name}&quot;</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-has_items-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">has_items?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Does this order have items?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="has_items-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 82</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">has_items?</span>
  <span class="ruby-identifier">total_items</span> <span class="ruby-operator">&gt;</span> <span class="ruby-value">0</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-invoiced-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">invoiced?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is the order invoiced?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="invoiced-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 99</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">invoiced?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">invoice_number</span>.<span class="ruby-identifier">blank?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-items_sub_total" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">items_sub_total</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The total price of all items in the basket excluding delivery</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="items_sub_total-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 47</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">items_sub_total</span>
  <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)) { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">sub_total</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-number" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">number</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The order number</p>

<p>@return [String] - the order number padded with at least 5 zeros</p>
          
          

          
          <div class="method-source-code" id="number-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 44</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">number</span>
  <span class="ruby-identifier">id</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">id</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">rjust</span>(<span class="ruby-value">6</span>, <span class="ruby-string">&#39;0&#39;</span>) <span class="ruby-operator">:</span> <span class="ruby-keyword">nil</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-paid_in_full-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">paid_in_full?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Has this order been paid in full?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="paid_in_full-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 92</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">paid_in_full?</span>
  <span class="ruby-operator">!</span><span class="ruby-identifier">payment_outstanding?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-payment_outstanding-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">payment_outstanding?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is there a payment still outstanding on this order?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="payment_outstanding-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 85</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">payment_outstanding?</span>
  <span class="ruby-identifier">balance</span> <span class="ruby-operator">&gt;</span> <span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-proceed_to_confirm" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">proceed_to_confirm</span><span
            class="method-args">(params = {})</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>This method should be called by the base application when the user has
completed their first round of entering details. This will mark the order
as “confirming” which means the customer now just must confirm.</p>

<p>@param params [Hash] a hash of order attributes @return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="proceed_to_confirm-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/actions.rb, line 15</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">proceed_to_confirm</span>(<span class="ruby-identifier">params</span> = {})
  <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;confirming&#39;</span>
  <span class="ruby-keyword">if</span> <span class="ruby-identifier">update</span>(<span class="ruby-identifier">params</span>)
    <span class="ruby-keyword">true</span>
  <span class="ruby-keyword">else</span>
    <span class="ruby-keyword">false</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-profit" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">profit</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the price for the order</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="profit-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 40</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">profit</span>
  <span class="ruby-identifier">total_before_tax</span> <span class="ruby-operator">-</span> <span class="ruby-identifier">total_cost</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-received-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">received?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Has the order been received?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="received-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/states.rb, line 62</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">received?</span>
  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">received_at?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-reject-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">reject!</span><span
            class="method-args">(user = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Mark order as rejected</p>

<p>@param user [Shoppe::User] the user who carried out the action</p>
          
          

          
          <div class="method-source-code" id="reject-21-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/actions.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">reject!</span>(<span class="ruby-identifier">user</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">run_callbacks</span> <span class="ruby-value">:rejection</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rejected_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">rejecter</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;rejected&#39;</span>
    <span class="ruby-identifier">save!</span>
    <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">each</span>(<span class="ruby-operator">&amp;</span><span class="ruby-value">:reject!</span>)
    <span class="ruby-identifier">deliver_rejected_order_email</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-rejected-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">rejected?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Has this order been rejected?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="rejected-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/states.rb, line 48</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">rejected?</span>
  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">rejected_at</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-remove_delivery_service_if_invalid" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">remove_delivery_service_if_invalid</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Remove the associated delivery service if it&#39;s invalid</p>
          
          

          
          <div class="method-source-code" id="remove_delivery_service_if_invalid-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 200</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">remove_delivery_service_if_invalid</span>
  <span class="ruby-keyword">unless</span> <span class="ruby-identifier">valid_delivery_service?</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">delivery_service</span> = <span class="ruby-keyword">nil</span>
    <span class="ruby-identifier">save</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-ship-21" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">ship!</span><span
            class="method-args">(consignment_number, user = nil)</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Mark this order as shipped</p>
          
          

          
          <div class="method-source-code" id="ship-21-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 216</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">ship!</span>(<span class="ruby-identifier">consignment_number</span>, <span class="ruby-identifier">user</span> = <span class="ruby-keyword">nil</span>)
  <span class="ruby-identifier">run_callbacks</span> <span class="ruby-value">:ship</span> <span class="ruby-keyword">do</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shipped_at</span> = <span class="ruby-constant">Time</span>.<span class="ruby-identifier">now</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">shipper</span> = <span class="ruby-identifier">user</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">user</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">status</span> = <span class="ruby-string">&#39;shipped&#39;</span>
    <span class="ruby-keyword">self</span>.<span class="ruby-identifier">consignment_number</span> = <span class="ruby-identifier">consignment_number</span>
    <span class="ruby-identifier">save!</span>
    <span class="ruby-constant">Shoppe</span><span class="ruby-operator">::</span><span class="ruby-constant">OrderMailer</span>.<span class="ruby-identifier">shipped</span>(<span class="ruby-keyword">self</span>).<span class="ruby-identifier">deliver</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-shipped-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">shipped?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Has this order been shipped?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="shipped-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 108</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">shipped?</span>
  <span class="ruby-operator">!</span><span class="ruby-operator">!</span><span class="ruby-identifier">shipped_at?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-tax" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">tax</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The total amount of tax due on this order</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="tax-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 61</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">tax</span>
  <span class="ruby-identifier">delivery_tax_amount</span> <span class="ruby-operator">+</span>
    <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)) { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">tax_amount</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-total" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">total</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The total of the order including tax</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="total-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 69</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">total</span>
  <span class="ruby-identifier">delivery_price</span> <span class="ruby-operator">+</span>
    <span class="ruby-identifier">delivery_tax_amount</span> <span class="ruby-operator">+</span>
    <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)) { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">total</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-total_before_tax" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">total_before_tax</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The total price of the order before tax</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="total_before_tax-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 54</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">total_before_tax</span>
  <span class="ruby-identifier">delivery_price</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">items_sub_total</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-total_cost" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">total_cost</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The total cost of the order</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="total_cost-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/billing.rb, line 32</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">total_cost</span>
  <span class="ruby-identifier">delivery_cost_price</span> <span class="ruby-operator">+</span>
    <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)) { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">total_cost</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-total_items" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">total_items</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Return the number of items in the order?</p>

<p>@return [Integer]</p>
          
          

          
          <div class="method-source-code" id="total_items-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order.rb, line 89</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">total_items</span>
  <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-value">0</span>) { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">quantity</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-total_weight" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">total_weight</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>The total weight of the order</p>

<p>@return [BigDecimal]</p>
          
          

          
          <div class="method-source-code" id="total_weight-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 115</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">total_weight</span>
  <span class="ruby-identifier">order_items</span>.<span class="ruby-identifier">inject</span>(<span class="ruby-constant">BigDecimal</span>(<span class="ruby-value">0</span>)) { <span class="ruby-operator">|</span><span class="ruby-identifier">t</span>, <span class="ruby-identifier">i</span><span class="ruby-operator">|</span> <span class="ruby-identifier">t</span> <span class="ruby-operator">+</span> <span class="ruby-identifier">i</span>.<span class="ruby-identifier">total_weight</span> }
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
      <div id="method-i-valid_delivery_service-3F" class="method-detail ">
        
        <div class="method-heading">
          <span class="method-name">valid_delivery_service?</span><span
            class="method-args">()</span>
          
          <span class="method-click-advice">click to toggle source</span>
          
        </div>
        

        <div class="method-description">
          
          <p>Is the currently assigned delivery service appropriate for this order?</p>

<p>@return [Boolean]</p>
          
          

          
          <div class="method-source-code" id="valid_delivery_service-3F-source">
            <pre><span class="ruby-comment"># File app/models/shoppe/order/delivery.rb, line 195</span>
<span class="ruby-keyword">def</span> <span class="ruby-identifier">valid_delivery_service?</span>
  <span class="ruby-identifier">delivery_service</span> <span class="ruby-operator">?</span> <span class="ruby-identifier">available_delivery_services</span>.<span class="ruby-identifier">include?</span>(<span class="ruby-identifier">delivery_service</span>) <span class="ruby-operator">:</span> <span class="ruby-operator">!</span><span class="ruby-identifier">delivery_required?</span>
<span class="ruby-keyword">end</span></pre>
          </div>
          
        </div>

        

        
      </div>

    
    </section>
  
  </section>
</main>


<footer id="validator-badges" role="contentinfo">
  <p><a href="http://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="http://docs.seattlerb.org/rdoc/">RDoc</a> 4.3.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

